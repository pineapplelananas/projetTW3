<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
              integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
              crossorigin=""/>
        <link rel="stylesheet" href="test.css"/>
        <!-- Make sure you put this AFTER Leaflet's CSS -->
        <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
                integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
                crossorigin="">
        </script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

        <link rel="stylesheet" type="text/css" href="css/reset.css"/>

        <link rel="stylesheet" type="text/css" href="css/main.css"/>	
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/velocity.js"></script>
        <script type="text/javascript" src="js/snap_svg.js"></script>
        <script type="text/javascript" src="js/main.js"></script>

        <script src='https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />


        <link rel="stylesheet" type="text/css" href="semantic/semantic.min.css">
        
        <script src="semantic/semantic.min.js"></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>

        <title>Ancien étudiant</title>

    </head>

    <body ng-app="App" ng-controller="Ctrl" class="Site">
        <main class="site-content">
            <div class="ui center aligned header">
                <button class="ui facebook button">
                    <i class="facebook icon"></i>
                    Facebook
                </button>
                <button class="ui linkedin button">
                    <i class="linkedin icon"></i>
                    LinkedIn
                </button>
                <button class="ui facebook button"><i class="graduation cap icon"></i>Univ. Champollion</button>
            </div>
            <div class="ui middle aligned center aligned grid">

                <div class="six wide column">
                    <img class="ui centered small rounded image" src="img/LOGO_CHAMPOLLION.png">
                </div>
                <div class="ten wide column">

                    <h1>Gestion de votre profil étudiant</h1>

                </div>

            </div>


            <div id="sub-header" class="ui middle aligned center aligned grid">
                <div class="sixteen wide column">

                </div>
            </div>
            <div id="page-ancien" class="ui 	container">

                <div class="wrapper">

                    <!--  start Form Steps  -->
                    <div class="steps" id="steps">
                        <span class="step_nb"></span>
                        <form action="#" method="post" autocomplete="off">
                            <ul>
                                <li class="current_step">
                                    <h3>Quel est votre nom de famille?</h3>
                                    <input type="text" class="text_field" id="nom" name="nom" placeholder="Entrez votre nom de famille"/>					
                                </li>
                                 <li>
                                     <h3>Quel est votre prénom?</h3>
                                    <input type="text" class="text_field" id="prenom" name="prenom" placeholder="Entrez votre prénom"/>	
                                </li>
                                <li>
                                    <h3>Quelle est votre adresse mail?</h3>
                                    <input type="text" class="text_field" id="email" name="email" placeholder="Entrez votre adresse mail"/>	
                                </li>
                                <li>
                                    <h3>Dans quelle région étudiez-vous?</h3>
                                    <select name="ville" id="ville">
                                        <option ng-cloak ng-repeat="ville in villes" value="{{ville.name}}">{{ville.name}}</option>
                                    </select>	
                                </li>
                                <li>
                                    <h3>Dans quelle établissement étudiez-vous?</h3>
                                    <select name="etab" id="etab">
                                        <option ng-cloak ng-repeat="etablissement in etablissements" value="{{etablissement.id}}">{{etablissement.name}}</option>
                                    </select>	
                                </li>
                                <li>
                                    <h3>Quel cursus avez vous suivi ?</h3>
                                    <select name="cursus" id="cursus">
                                        <option ng-cloak ng-repeat="curs in cursus" value="{{curs.id}}">{{curs.name}}</option>
                                    </select>	
                                </li>
                                <li>
                                    <h3>Quelle mention avez-vous obtenu en L3 ?</h3>
                                    <select name="mention" id="mention">
                                        <option ng-cloak ng-repeat="mention in mentions" value="{{mention.id}}">{{mention.name}}</option>
                                    </select>	
                                </li>
                                <li>
                                     <h3>Votre avis sur votre poursuite d'études?</h3>
                                     <textarea name="avis" cols="40" rows="5" placeholder="Les points positifs, négatifs, vos matières préférées..."></textarea>
                                </li>
                            </ul>
                        </form>
                        <span class="note">Note : Vous pouvez appuyer sur "Entrée" pour passer d'étape</span>
                    </div><!--  End Form Steps  -->
                </div>
            </div>
        </main>
        <div class="ui grid">
            <div class="sixteen wide column">
            </div>
        </div>
        <div id="footer" class="ui stackable three column grid">
            <div class="ui middle aligned center aligned column">
                <button class="ui inverted button">Connexion ancien étudiant</button>

            </div>
            <div class="ui middle aligned center aligned column">
                <i class="copyright icon"></i>2018 - Pour toute question, s'adresser à l'Université Jean-François Champollion
            </div>
            <div class="ui middle aligned center aligned column">
                Site réalisé par les étudiants de la Licence 3 Informatique

            </div>
        </div>
        <script>
                    //angularjs
                    var app = angular.module("App", []);
                    app.controller("Ctrl", function ($scope, $http) {
                        //datas
                        
                        
                        $scope.villes = [];

                        $scope.etablissements = [];

                        $scope.formations = [];

                        $scope.cursus = [];
                        
                        $scope.mentions = [];


                        $scope.buttonClick = function () {

                            $('#rechercher').show();

                            $http.get("http://licinfo.univ-jfc.fr:8080/twmprojets/etablissements")
                                    .then(function (response) {
                                        if (response.data.length === 0) {
                                            $scope.resultEtablissements.push({nom_etab: "Aucun résultat, cliquez réinitialiser le formulaire"});
                                        } else {
                                            $scope.resultEtablissements = response.data.data;
                                        }
                                    });
                            $('#rechercher').hide();
                        };

                        $http.get("http://licinfo.univ-jfc.fr:8080/twmprojets/etablissements")
                                .then(function (response) {
                                    
                                    console.log(response);
                                    for (var i = 0; i < response.data.data.length; i++) {
                                        var item = response.data.data[i].ville_etab;
                                        var dept = response.data.data[i].code_postal_etab.substring(0, 2);
                                        $scope.villes.push({"name": item, "code_dept": dept});
                                    }
                                    

                                });

                

                        $http.get("http://licinfo.univ-jfc.fr:8080/twmprojets/etablissements")
                                .then(function (response) {
                                    for (var i = 0; i < response.data.data.length; i++) {
                                        $scope.etablissements.push({"id": response.data.data[i].id_etablissement, "name": response.data.data[i].nom_etab});
                                    }
                                });

                        $http.get("http://licinfo.univ-jfc.fr:8080/twmprojets/formations")
                                .then(function (response) {
                                    for (var i = 0; i < response.data.data.length; i++) {
                                        $scope.formations.push({"id": response.data.data[i].id_formation, "name": response.data.data[i].intitule_form});
                                    }
                                });
                        $http.get("http://licinfo.univ-jfc.fr:8080/twmprojets/cursus")
                                .then(function (response) {
                                    for (var i = 0; i < response.data.data.length; i++) {
                                        $scope.cursus.push({"id": response.data.data[i].id_cursus, "name": response.data.data[i].lib_cursus});
                                    }
                                });
                                
                        $http.get("http://licinfo.univ-jfc.fr:8080/twmprojets/moyennes_l3")
                                .then(function (response) {
                                    for (var i = 0; i < response.data.data.length; i++) {
                                        $scope.mentions.push({"id": response.data.data[i].id_moyenne, "name": response.data.data[i].mention});
                                    }
                                });
                        //on-ready, map
                        angular.element(document).ready(function () {
                        });


                    });
        </script>
    </body>
</html> 